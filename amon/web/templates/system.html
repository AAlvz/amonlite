{% extends "base.html" %}

{% block breadcrumb %}
System check 
{% endblock %}
{% block content %}
<ul class='tabs'>
	<li>
		<a {% if active_tab == 'day' %} class='active' {% endif %} href="/system">24 hours</a>
	</li>
	<li>
		<a href="/system/?date_from={{ week_ago|date }}">1 week</a>
	</li>
	<li>
		<a href="/system/?date_from={{ month_ago|date }}">1 month</a>
	</li>
</ul>
<h2>Memory</h2>
<div class="chart" id="memory"></div>
<div class='legend'>
		<ul>
			<li>
				<span class="color one"></span>
				<span>Total memory</span>
			</li>
			<li>
			<span class="color two"><!-- --></span>
				<span>Free memory</span>
			</li>
		</ul>
</div>

<h2>Loadavg</h2>
<div class="chart" id="loadavg"></div>
<div class='legend'>

		<ul>
			<li>
				<span class="color one"></span>
				<span>1 minute</span>
			</li>
			<li>
			<span class="color two"><!-- --></span>
				<span>5 minutes</span>
			</li>
			<li>
				<span class="color three"><!-- --></span>
				<span>15 minutes</span>
			</li>
		</ul>
</div>


<h2>CPU</h2>
<div class="chart" id="cpu"></div>

<div class='legend'>

		<ul>
			<li>
				<span class="color one"></span>
				<span>Idle</span>
			</li>
			<li>
			<span class="color two"><!-- --></span>
				<span>System</span>
			</li>
			<li>
				<span class="color three"><!-- --></span>
				<span>User</span>
			</li>
		</ul>
</div>


<h2>Network</h2>
{% for interface in network_interfaces %}
{% if interface != 'lo' %}
	<h3>{{ interface }}</h3>
	<div class="chart" id="network_{{ interface }}"></div>
	<div class='legend'>

		<ul>
			<li>
				<span class="color one"></span>
				<span>Recieved</span>
			</li>
			<li>
			<span class="color two"><!-- --></span>
				<span>Transfered</span>
			</li>
		</ul>
	</div>
{% endif %}
{% endfor %}

<h2>Disk</h2>
{% for volume in volumes  %}
	<h3>{{ volume }}</h3>
	<div class="chart" id="disk_{{ volume }}"></div>
	<div class='legend'>

		<ul>
			<li>
				<span class="color one"></span>
				<span>Total</span>
			</li>
			<li>
			<span class="color two"><!-- --></span>
				<span>Free</span>
			</li>
		</ul>
	</div>
{% endfor %}

<script language="javascript" type="text/javascript">
$(function () 
{

	function showTooltip(x, y, contents) {
        $('<div id="tooltip">' + contents + '</div>').css( {
            top: y + 5,
            left: x + 5,
        }).appendTo("body").fadeIn(200);
    }


	var previousPoint = null;
    $(".chart").bind("plothover", function (event, pos, item) {
        $("#x").text(pos.x.toFixed(2));
        $("#y").text(pos.y.toFixed(2));

		if (item) 
		{
			if (previousPoint != item.datapoint) 
			{
                    previousPoint = item.datapoint;
                    
                    $("#tooltip").remove();
                    var x = item.datapoint[0].toFixed(2),
                        y = item.datapoint[1].toFixed(2);
					
					_date = new Date(parseInt(x));
                    showTooltip(item.pageX, item.pageY,
                                item.series.label + " on " + _date.format('dd/mm/yy H:ss')  + " -  " + y);
                }
        }
		else 
		{
            $("#tooltip").remove();
            previousPoint = null;            
        }
    
    });


	var memory_total = [{% for m in memory %} [ {{ m.time * 1000 }}, {{ m.memtotal }}], {% endfor %}];
	var memory_free = [{% for m in memory %} [ {{ m.time * 1000 }}, {{ m.memfree }}], {% endfor %}];
	var memory_legend = $('#memory_legend');

    $.plot($("#memory"),
           [	{ data: memory_total, label: "Total memory" },
				{ data: memory_free, label: "Free memory"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
			});


	var loadavg_minute =		[{% for l in loadavg %} [ {{ l.time * 1000 }}, {{ l.minute }} ],  {% endfor %}];
	var loadavg_five_minutes =		[{% for  l in loadavg %} [ {{ l.time * 1000 }}, {{ l.five_minutes }} ],  {% endfor %}];
	var loadavg_fifteen_minutes =  [{% for  l in loadavg %} [ {{ l.time * 1000 }},  {{ l.fifteen_minutes }} ],  {% endfor %}];
	var loadavg_legend = $('#loadavg_legend');

    $.plot($("#loadavg"),
           [	{ data: loadavg_minute, label: "One minute" },

				{ data: loadavg_five_minutes, label: "Five minutes"  },
				{ data: loadavg_fifteen_minutes, label: "Fifteen minutes"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
			});


	var cpu_idle =	[{% for  c in cpu %} [ {{ c.time * 1000 }}, {{ c.idle }} ] ,  {% endfor %}];
	var cpu_user =	[{% for  c in cpu %} [ {{ c.time * 1000 }} ,  {{ c.user }} ] ,  {% endfor %}];
	var cpu_system =  [{% for  c in cpu %} [ {{ c.time * 1000 }} ,  {{ c.system }} ] ,  {% endfor %}];
	var cpu_legend = $('#cpu_legend');

    $.plot($("#cpu"),
           [	{ data: cpu_idle, label: "Idle" },
				{ data: cpu_user, label: "User"  },
				{ data: cpu_system, label: "System"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
	
			});


	{% for interface  in network_interfaces  %}
		
		{% if interface != 'lo' %}
		
		var network_recieved_{{ interface }} =   [
						{% for n in network %}
							[ {{ n.time * 1000 }}, {%if n[interface] %} {{ n[interface].recv_bytes }} {% endif %} ] , 
						{% endfor %}];
		var network_transfered_{{ interface }} = [
						{% for n in network %} 
							[ {{ n.time * 1000 }}, {% if n[interface] %}  {{ n[interface].trans_bytes }} {% endif %} ] ,
						{% endfor %}];
	
		$.plot($("#network_{{ interface }}"),
			[	
				{ data: network_recieved_{{ interface }}, label: "Recieved" },
				{ data: network_transfered_{{ interface }}, label: "Transfered"  },
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
	
			});
		{% endif %}
	{% endfor %}


	{% for volume in volumes  %}
	
	var disk_total_{{ volume }} =	[
					{% for  d in disk %} [ 
						{{ d.time * 1000 }}, {% if d[volume] %}  {{ d[volume].total|to_int }}  {% endif %}    ],  
					{% endfor %}];
	var disk_free_{{ volume }} = [
				{% for  d in disk %}
					[ {{ d.time * 1000 }}, {% if d[volume] %} {{ d[volume].free|to_int }} {% endif %} ],
				{% endfor %}];


	$.plot($("#disk_{{ volume }}"),
			[	
				{ data: disk_total_{{ volume }}, label: "Total" },
				{ data: disk_free_{{ volume }}, label: "Free"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
			});
	{% endfor %}



});
</script>
{% endblock %}



{% block header %}
<script type="text/javascript" src='/media/js/jquery-1.5.1.min.js'></script>
<script type="text/javascript" src='/media/js/date.format.min.js'></script>
<script type="text/javascript" src='/media/js/jquery.flot.js'></script>
{% endblock %}
