{% extends "base.html" %}

{% block breadcrumb %}
System details > 127.0.0.1 ( localhost )

{% endblock %}
{% block content %}
<h2>Memory</h2>
<div class="chart" id="memory"></div>
<div class='legend' id="memory_legend"></div>

<h2>Loadavg</h2>
<div class="chart" id="loadavg"></div>
<div class='legend' id="loadavg_legend"></div>

<h2>CPU</h2>
<div class="chart" id="cpu"></div>
<div class='legend' id="cpu_legend"></div>


<h2>Network</h2>
{% for interface in network_interfaces %}
{% if interface != 'lo' %}
	<div class="chart" id="network_{{ interface }}"></div>
{% endif %}
{% endfor %}

<h2>Disk</h2>
{% for volume in volumes  %}
	<div class="chart" id="disk_{{ volume }}"></div>
{% endfor %}

<script language="javascript" type="text/javascript">
$(function () 
{

	function showTooltip(x, y, contents) {
        $('<div id="tooltip">' + contents + '</div>').css( {
            top: y + 5,
            left: x + 5,
        }).appendTo("body").fadeIn(200);
    }


	var previousPoint = null;
    $(".chart").bind("plothover", function (event, pos, item) {
        $("#x").text(pos.x.toFixed(2));
        $("#y").text(pos.y.toFixed(2));

		if (item) 
		{
			if (previousPoint != item.datapoint) 
			{
                    previousPoint = item.datapoint;
                    
                    $("#tooltip").remove();
                    var x = item.datapoint[0].toFixed(2),
                        y = item.datapoint[1].toFixed(2);
					
					_date = new Date(parseInt(x));
                    showTooltip(item.pageX, item.pageY,
                                item.series.label + " on " + _date.format('dd/mm/yy H:ss')  + " -  " + y);
                }
        }
		else 
		{
            $("#tooltip").remove();
            previousPoint = null;            
        }
    
    });


	var memory_total = [{% for m in memory %} [ {{ m.time * 1000 }}, {{ m.memtotal }}], {% endfor %}];
	var memory_free = [{% for m in memory %} [ {{ m.time * 1000 }}, {{ m.memfree }}], {% endfor %}];
	var memory_legend = $('#memory_legend');

    $.plot($("#memory"),
           [	{ data: memory_total, label: "Total memory" },
				{ data: memory_free, label: "Free memory"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
				legend: {show: true, container: memory_legend}, 
			});


	var loadavg_minute =		[{% for l in loadavg %} [ {{ l.time * 1000 }}, {{ l.minute }} ],  {% endfor %}];
	var loadavg_five_minutes =		[{% for  l in loadavg %} [ {{ l.time * 1000 }}, {{ l.five_minutes }} ],  {% endfor %}];
	var loadavg_fifteen_minutes =  [{% for  l in loadavg %} [ {{ l.time * 1000 }},  {{ l.fifteen_minutes }} ],  {% endfor %}];
	var loadavg_legend = $('#loadavg_legend');

    $.plot($("#loadavg"),
           [	{ data: loadavg_minute, label: "One minute" },

				{ data: loadavg_five_minutes, label: "Five minutes"  },
				{ data: loadavg_fifteen_minutes, label: "Fifteen minutes"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
				legend: {show: true, container: loadavg_legend}, 
			});


	var cpu_idle =	[{% for  c in cpu %} [ {{ c.time * 1000 }}, {{ c.idle }} ] ,  {% endfor %}];
	var cpu_user =	[{% for  c in cpu %} [ {{ c.time * 1000 }} ,  {{ c.user }} ] ,  {% endfor %}];
	var cpu_system =  [{% for  c in cpu %} [ {{ c.time * 1000 }} ,  {{ c.system }} ] ,  {% endfor %}];
	var cpu_legend = $('#cpu_legend');

    $.plot($("#cpu"),
           [	{ data: cpu_idle, label: "Idle" },
				{ data: cpu_user, label: "User"  },
				{ data: cpu_system, label: "System"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
				legend: {show: true, container: cpu_legend}, 
	
			});


	{% for interface  in network_interfaces  %}
		
		{% if interface != 'lo' %}
		
		var network_recieved_{{ interface }} =   [{% for n in network %} [  {{ n.time * 1000 }}, {{ n[interface].recv_bytes }} ] ,  {% endfor %}];
		var network_transfered_{{ interface }} = [{% for n in network %} [ {{ n.time * 1000 }},  {{ n[interface].trans_bytes }} ] ,  {% endfor %}];
	
		$.plot($("#network_{{ interface }}"),
			[	
				{ data: network_transfered_{{ interface }}, label: "Transfered" },
				{ data: network_recieved_{{ interface }}, label: "Recieved"  },
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
	
			});
		{% endif %}
	{% endfor %}


	{% for volume in volumes  %}
	
		  var disk_total_{{ volume }} =	[{% for  d in disk %} [ {{ d.time * 1000 }},  {{ d[volume].total|to_int }} ],  {% endfor %}];
		  var disk_free_{{ volume }} = [{% for  d in disk %}[ {{ d.time * 1000 }}, {{ d[volume].free|to_int }} ],  {% endfor %}];


	$.plot($("#disk_{{ volume }}"),
			[	
				{ data: disk_total_{{ volume }}, label: "Total" },
				{ data: disk_free_{{ volume }}, label: "Free"  }
		   ],
           { 
				xaxis: { mode: 'time' },
				yaxis: { min: 0 },
			});
	{% endfor %}



});
</script>
{% endblock %}



{% block header %}
<script type="text/javascript" src='/media/js/jquery-1.5.1.min.js'></script>
<script type="text/javascript" src='/media/js/date.format.min.js'></script>
<script type="text/javascript" src='/media/js/jquery.flot.js'></script>
{% endblock %}
